buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "io.spring.gradle:dependency-management-plugin:1.0.2.RELEASE"
    }
}

description='Spring Recipes 4th Edition - Sources'

allprojects {
    group = 'com.apress.springrecipes'
    version = '4.0.0-SNAPSHOT'

    // Define repositorie to get dependencies
    repositories {
        mavenCentral()
        // Public Spring artifacts
        maven { url "http://repo.spring.io/release" }
        maven { url "http://repo.spring.io/libs-release"}
        maven { url "http://repo.spring.io/milestone" }
    }
}

subprojects { subproject ->

    apply plugin: 'java'
    apply plugin: "io.spring.dependency-management"

    ext['spring.version'] = '5.0.0.M5'
    ext['spring-data-releasetrain.version'] = 'Kay-M1'
    ext['spring-integration.version'] = '5.0.0.M3'
    ext['hibernate.version'] = '5.2.9.Final'
    ext['assertj.version'] = '3.6.2'

    ext {
        springIOPlatform            = 'Brussels-SR1'
        apacheCxfVersion            = '3.1.10'
    }


	compileJava.options*.compilerArgs = [
		"-Xlint:serial", "-Xlint:varargs", "-Xlint:cast", "-Xlint:classfile",
		"-Xlint:dep-ann", "-Xlint:divzero", "-Xlint:empty", "-Xlint:finally",
		"-Xlint:overrides", "-Xlint:path", "-Xlint:processing", "-Xlint:static",
		"-Xlint:try", "-Xlint:fallthrough", "-Xlint:rawtypes", "-Xlint:deprecation",
		"-Xlint:unchecked", "-Xlint:-options"
	]

	compileTestJava.options*.compilerArgs = [
		"-Xlint:serial", "-Xlint:varargs", "-Xlint:cast", "-Xlint:classfile",
		"-Xlint:dep-ann", "-Xlint:divzero", "-Xlint:empty", "-Xlint:finally",
		"-Xlint:overrides", "-Xlint:path", "-Xlint:processing", "-Xlint:static",
		"-Xlint:try", "-Xlint:-fallthrough", "-Xlint:-rawtypes", "-Xlint:-deprecation",
		"-Xlint:-unchecked", "-Xlint:-options"]

    sourceCompatibility=1.8
    targetCompatibility=1.8

	configurations {
		// We want to use SLF4J for logging, ban commons-logging
		all*.exclude group: 'commons-logging', module: 'commons-logging'
	}

    dependencyManagement {
        imports {
            mavenBom "io.spring.platform:platform-bom:$springIOPlatform"
//            mavenBom "org.springframework:spring-framework-bom:$springVersion"
//            mavenBom "org.springframework.data:spring-data-releasetrain:$springDataRelease"
//            mavenBom "org.springframework.integration:spring-integration-bom:$springIntegrationVersion"
        }
    }

	dependencies {
		compile("org.slf4j:slf4j-api")
		compile("org.slf4j:jcl-over-slf4j")
		compile("ch.qos.logback:logback-classic")

    	// Add dependencies for testing (these will only be used for the testing phase)
		testCompile("junit:junit")
		testCompile("org.mockito:mockito-core")
        testCompile("org.assertj:assertj-core")
		testCompile("org.springframework:spring-test")
	}
	

	task copyDependenciesToLibDir( type: Copy ) {
		into "$buildDir/libs/lib"
		from configurations.runtime
	}

    jar {
        // Copy jar dependencies and add to Class-Path.
        dependsOn copyDependenciesToLibDir
        def deps = fileTree(dir: "$buildDir/libs/lib", include: '*.jar')
        manifest.attributes("Class-Path": deps.files.collect {'lib/'+it.name}.join(' '))
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '3.4.1'
}